# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy store
on:
   push:
      branches:
         - main

env:
   NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
   GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
   on_merge_master:
      runs-on: ubuntu-latest
      steps:
         - name: checkout
           uses: actions/checkout@v4
           with:
              fetch-depth: 2;

         - name: check if core package changed
           id: folder-check
           run: |
              if git diff --quiet HEAD~1 HEAD -- packages/core/; then
              echo "CORE_CHANGE=false" >> $GITHUB_ENV
              else
              echo "CORE_CHANGE=true" >> $GITHUB_ENV
              fi

         - name: Run step only if folder changed
           if: env.CORE_CHANGE == 'true'
           run: echo "Folder 'packages/core/' has changed, executing this step!"

   store_job:
      runs-on: ubuntu-latest
      steps:
         - uses: actions/checkout@v4

         - name: enter store folder
           run: |
              pwd
              yarn && yarn build

         - uses: FirebaseExtended/action-hosting-deploy@v0
           with:
              repoToken: ${{ secrets.GITHUB_TOKEN }}
              firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_JSDEV_STORES_PROD }}
              channelId: live
              projectId: jsdev-stores-prod
              entryPoint: apps/store
           env:
              FIREBASE_CLI_EXPERIMENTS: webframeworks
